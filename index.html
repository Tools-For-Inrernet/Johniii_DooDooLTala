<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Johniii DooDooLTala - Webvisor Demo</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --bg: #f8fafc;
      --text: #1e293b;
      --muted: #64748b;
      --border: #e2e8f0;
      --success: #22c55e;
      --error: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--muted);
      font-size: 1.1rem;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 9999px;
      margin-top: 1rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--muted);
    }

    .status-dot.recording {
      background: var(--success);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    textarea,
    select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    button {
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: var(--primary-dark);
    }

    button.secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
    }

    button.secondary:hover {
      background: var(--bg);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .scroll-area {
      height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
    }

    .scroll-content {
      height: 500px;
      background: linear-gradient(180deg, var(--primary) 0%, var(--success) 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 500;
    }

    .private-section {
      background: #fef3c7;
      border-color: #f59e0b;
    }

    .private-section h2 {
      color: #92400e;
    }

    .events-log {
      font-family: monospace;
      font-size: 0.85rem;
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 8px;
      height: 200px;
      overflow-y: auto;
    }

    .events-log .event {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #334155;
    }

    .events-log .timestamp {
      color: var(--muted);
    }

    footer {
      text-align: center;
      color: var(--muted);
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Webvisor Demo</h1>
      <p class="subtitle">Session Recording & Replay</p>
      <div class="status-badge">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Not Recording</span>
      </div>
    </header>

    <div class="card">
      <h2>Controls</h2>
      <div class="btn-group">
        <button id="startBtn">Start Recording</button>
        <button id="stopBtn" class="secondary">Stop Recording</button>
      </div>
    </div>

    <div class="card">
      <h2>Interaction Test</h2>
      <p>Click, scroll, and interact to generate events.</p>

      <div class="form-group" style="margin-top: 1rem;">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Enter username">
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter email">
      </div>

      <div class="form-group">
        <label for="category">Category</label>
        <select id="category">
          <option value="">Select category</option>
          <option value="tech">Technology</option>
          <option value="health">Health</option>
          <option value="finance">Finance</option>
        </select>
      </div>

      <div class="form-group">
        <label for="message">Message</label>
        <textarea id="message" rows="3" placeholder="Type your message..."></textarea>
      </div>
    </div>

    <div class="card private-section" data-ym-disable>
      <h2>Private Section (Excluded)</h2>
      <p>This section has <code>data-ym-disable</code> attribute. Interactions here are not recorded.</p>

      <div class="form-group" style="margin-top: 1rem;">
        <label for="privateInput">Private Input</label>
        <input type="text" id="privateInput" placeholder="This won't be recorded">
      </div>
    </div>

    <div class="card">
      <h2>Sensitive Fields (Auto-Masked)</h2>
      <p>Password and credit card fields are automatically masked.</p>

      <div class="form-group" style="margin-top: 1rem;">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter password">
      </div>

      <div class="form-group">
        <label for="creditCard">Credit Card</label>
        <input type="text" id="creditCard" name="credit_card" placeholder="1234 5678 9012 3456">
      </div>
    </div>

    <div class="card">
      <h2>Scroll Test</h2>
      <div class="scroll-area">
        <div class="scroll-content">Scroll me!</div>
      </div>
    </div>

    <div class="card">
      <h2>Event Log</h2>
      <div class="events-log" id="eventsLog">
        <div class="event">Waiting to start recording...</div>
      </div>
    </div>

    <footer>
      <p>Johniii DooDooLTala - Website HTML Static Meter</p>
      <p>MIT License &copy; 2025 Tools for Internet</p>
    </footer>
  </div>

  <script type="module">
    import { Webvisor } from './src/client/Webvisor.js';
    import { EventType } from './src/shared/constants.js';

    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const eventsLog = document.getElementById('eventsLog');

    // Event type names for display
    const eventNames = {
      [EventType.DOM_SNAPSHOT]: 'DOM_SNAPSHOT',
      [EventType.DOM_MUTATION]: 'DOM_MUTATION',
      [EventType.MOUSE_MOVE]: 'MOUSE_MOVE',
      [EventType.MOUSE_CLICK]: 'MOUSE_CLICK',
      [EventType.SCROLL]: 'SCROLL',
      [EventType.INPUT]: 'INPUT',
      [EventType.RESIZE]: 'RESIZE',
      [EventType.PAGE_LOAD]: 'PAGE_LOAD',
      [EventType.PAGE_TRANSITION]: 'PAGE_TRANSITION',
      [EventType.SESSION_START]: 'SESSION_START',
      [EventType.SESSION_END]: 'SESSION_END'
    };

    // Create webvisor instance with custom event handler for logging
    const webvisor = new Webvisor({
      samplingRate: 100,
      endpoint: '/api/webvisor/events',
      privacy: {
        maskSensitiveInputs: true,
        excludeAttribute: 'data-ym-disable'
      }
    });

    // Override handleEvent to log events
    const originalHandleEvent = webvisor.handleEvent.bind(webvisor);
    webvisor.handleEvent = (event) => {
      originalHandleEvent(event);
      logEvent(event);
    };

    function logEvent(event) {
      const eventName = eventNames[event.type] || `TYPE_${event.type}`;
      const time = new Date(event.timestamp).toLocaleTimeString();

      // Skip mouse move for cleaner logs
      if (event.type === EventType.MOUSE_MOVE) return;

      const logEntry = document.createElement('div');
      logEntry.className = 'event';
      logEntry.innerHTML = `<span class="timestamp">[${time}]</span> ${eventName}`;
      eventsLog.insertBefore(logEntry, eventsLog.firstChild);

      // Keep only last 50 entries
      while (eventsLog.children.length > 50) {
        eventsLog.removeChild(eventsLog.lastChild);
      }
    }

    function updateStatus(recording) {
      statusDot.classList.toggle('recording', recording);
      statusText.textContent = recording ? `Recording (${webvisor.getSessionId()})` : 'Not Recording';
      startBtn.disabled = recording;
      stopBtn.disabled = !recording;
    }

    startBtn.addEventListener('click', () => {
      const started = webvisor.start();
      if (started) {
        updateStatus(true);
        eventsLog.innerHTML = '';
      }
    });

    stopBtn.addEventListener('click', async () => {
      await webvisor.stop();
      updateStatus(false);
    });

    // Initial state
    updateStatus(false);

    // Expose to console for debugging
    window.webvisor = webvisor;
  </script>
</body>
</html>
